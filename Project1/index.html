<!DOCTYPE html>
<meta charset="utf-8">
<title>May's H517 Project #1</title>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="shortcut icon" href="images/icon.jpg">
<html>

<head>
    <style>


        path {
            fill: none;
            stroke: #000;
            stroke-width: .5px;
            stroke-linejoin: round;
            stroke-linecap: round;
        }

        .header {
            padding: 5px;
            text-align: center;
            background: #1abc9c;
            color: white;
            font-size: 12px;
        }

        body {
            margin: 0;
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-color: ghostwhite;
        }

        .canvas {
            background-color: white;
        }

        .toolTip {
            position: absolute;
            text-align: center;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 15px;
            padding: 5px 5px;
            font: 10px helvetica;
            font-weight:bold;
            background: none;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }

        #barChart {
            font: 10px ariel;
        }
    </style>
    <script src="https://d3js.org/d3.v3.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-contour.v1.min.js"></script>

</head>
<body>

    <div class="header">
        <h3>Mengmeng's H517 Project #1</h3>
        <p>Dr. John Snow Interactive Map</p>
        <a href="pictures/document.html">Document</a>&nbsp;&nbsp;&nbsp;&nbsp; <a href="https://youtu.be/KvlIzwH2IPM">YouTube Video</a>
        &nbsp;&nbsp;&nbsp;&nbsp; <a href="">Project</a>
    </div>


    <script>
        //Define margin
        var margin = { top: 10, right: 10, bottom: 10, left: 10 };

        //Define map projection
        var projection = d3
            .geoMercator() //Mercator projection
            .scale(2000)	//set zoom value
            .center([16.7, 13]); //set centerview

        //Define path generator
        var path = d3.geoPath()
            .projection(projection)

        //Define shapes to represent male and female death
        var diamond = d3.symbol().type(d3.symbolDiamond).size(50),
            cross = d3.symbol().type(d3.symbolCross).size(50);

        //Create SVG element
        var map = d3.select("body")
            .append("div") //append a div to make separation
            .attr("class", "w3-container")
            .attr("id", "main")
            .append("svg") //append svg element as canvas
            .attr("width", 600)
            .attr("height", 600)
            .attr("class", "canvas")
            .attr("id", "map")
            .attr("transform", "translate(" + 0 + "," + margin.top + ")")

        map.append("g") //append g to contain navigation so the map can move within canvas
            .attr("id", "navigation")

        map.append("g") //append g to contain legends
            .attr("id", "legend")

        barChart = d3.select("#main")
            .append("svg")
            .attr("width", 250)
            .attr("height", 600)
            .attr("id", "barChart")
            .attr("transform", "translate(60,10)")

        pieChart = d3.select("#main")
            .append("svg")
            .attr("width", 300)
            .attr("height", 600)
            .attr("id", "pieChart")
            .attr("transform", "translate(60,10)")

        toolTip = d3.select("body")
            .append("g")
            .attr("class", "toolTip")
            .style("opacity", 0)

        //Define navigation limits
        d3.select("#map")
            .call(d3.zoom()
                .scaleExtent([1, 5])
                .translateExtent([[-50, -50], [700, 700]])
                .on("zoom", function () {
                    d3.select("#navigation").attr("transform", d3.event.transform)
                }))

        //read geojson file
        d3.json("https://raw.githubusercontent.com/Cecilia0622/myFiles/master/streets_all_reset.json", streetMap)
        //draw map elements
        function streetMap(geojson) {
            var pumps = geojson.features.filter(function (d) { return d.geometry.type == "Point"; }),
                streets = geojson.features.filter(function (d) { return d.geometry.type == "LineString"; }),
                buildings = geojson.features.filter(function (d) { return d.geometry.type == "Polygon"; });

            d3.select("#navigation").append("g").attr("id", "streetLayer")
            d3.select("#navigation").append("g").attr("id", "streetLayer2")
            d3.select("#navigation").append("g").attr("id", "pumpLayer")
            d3.select("#navigation").append("g").attr("id", "buildingLayer")
            d3.select("#navigation").append("g").attr("id", "streetName")


            var streetLayer = d3.select("#streetLayer"),
                street2Layer = d3.select("#streetLayer2"),
                pumpLayer = d3.select("#pumpLayer"),
                buildingLayer = d3.select("#buildingLayer"),
                streetName = d3.select("#streetName");

            streetLayer.selectAll("path")
                .data(streets)
                .enter()
                .append("path")
                .attr("d", path)
                .style("stroke-width", "5")
                .style("stroke", "black")

            street2Layer.selectAll("path")
                .data(streets)
                .enter()
                .append("path")
                .attr("d", path)
                .style("stroke-width", "3")
                .style("stroke", "white")

            pumpLayer.selectAll("path")
                .data(pumps)
                .enter()
                .append("g")
                .attr("transform", function (d) { return "translate(" + projection(d.geometry.coordinates) + ")"; })
                .append("svg:image")
                .attr("id", "pump")
                .attr("xlink:href", "water-pump.svg")
                .attr("width", 25)
                .attr("height", 25)
                .on("mouseover", function (d) {
                    return toolTip.text(d.properties.name)
                        .style("opacity", .9)
                })
                .on("mousemove", function () {
                    return toolTip.style("top", (event.pageY - 40) + "px")
                        .style("left", (event.pageX - 10) + "px");
                })
                .on("mouseout", function () {
                    return toolTip.style("opacity", 0);
                })

            buildingLayer.selectAll("path")
                .data(buildings)
                .enter().append("g")
                .append("path")
                .attr("d", path)
                .style("stroke-width", "1")
                .style("stroke", "black")
                .style("fill", "green")

            buildingLayer.selectAll("g")
                .append("text")
                .text(function (d) { return d.properties.name; })
                .attr("font-family", "impact")
                .attr("font-size", "10px")
                .attr("stroke", "black")
                .attr("stroke-width", 0.5)
                .attr("text-anchor", "middle")
                .attr('fill', 'white')
                .attr("transform", function (d) {
                    if (d.properties.name == "WorkHouse")
                        return "translate(" + path.centroid(d)[0] + "," + path.centroid(d)[1] + ") rotate(-23)";
                    else
                        return "translate(" + path.centroid(d)[0] + "," + path.centroid(d)[1] + ") rotate(60)";
                }
                )

            streetName.selectAll("#streetName")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(170,347) rotate(60)")
                .text("Regent Street")
                .attr("font-family", "impact")
                .attr("font-size", "15px")
                .attr("fill", "black")
                .attr("stroke", "white")
                .attr("stroke-width", 0.5);

            streetName.selectAll("#streetName")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(275,121) rotate(-12)")
                .text("Oxford Steet")
                .attr("font-family", "impact")
                .attr("font-size", "15px")
                .attr("fill", "black")
                .attr("stroke", "white")
                .attr("stroke-width", 0.5);
            streetName.selectAll("#streetName")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(500,243) rotate(67)")
                .text("Dean Stree")
                .attr("font-family", "impact")
                .attr("font-size", "15px")
                .attr("fill", "black")
                .attr("stroke", "white")
                .attr("stroke-width", 0.5);
            streetName.selectAll("#streetName")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(327,300) rotate(-26)")
                .text("Broad Steet")
                .attr("font-family", "impact")
                .attr("font-size", "15px")
                .attr("fill", "black")
                .attr("stroke", "white")
                .attr("stroke-width", 0.5);
            streetName.selectAll("#streetName")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(180,245) rotate(-24)")
                .text("Great Marlborough Street")
                .attr("font-family", "impact")
                .attr("font-size", "15px")
                .attr("fill", "black")
                .attr("stroke", "white")
                .attr("stroke-width", 0.5);

            streetName.selectAll("#streetName")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(308,198) rotate(67)")
                .text("Poland Street")
                .attr("font-family", "impact")
                .attr("font-size", "15px")
                .attr("fill", "black")
                .attr("stroke", "white")
                .attr("stroke-width", 0.5);
        }


        d3.json("https://raw.githubusercontent.com/Cecilia0622/myFiles/master/deaths.json", deathMap)
        //draw deaths
        function deathMap(geojson) {
            var deathData = geojson.features,
                femaleDeaths = geojson.features.filter(function (d) { return d.properties.sex === "female"; }),
                maleDeaths = geojson.features.filter(function (d) { return d.properties.sex === "male"; }),
                legendLayer = d3.select("#legend"),
                densityData = d3.contourDensity();


            d3.select("#navigation").append("g").attr("class", "deathLayer").attr("id", "femaleDeathLayer")
            d3.select("#navigation").append("g").attr("class", "deathLayer").attr("id", "maleDeathLayer")

            var femaleDeathLayer = d3.select("#femaleDeathLayer"),
                maleDeathLayer = d3.select("#maleDeathLayer");

            femaleDeathLayer.selectAll("path")
                .data(femaleDeaths)
                .enter()
                .append("path")
                .attr("d", diamond)
                .attr("id", function (d) {
                    if (d.properties.age != ">80")
                        return "death" + d.properties.age
                    else
                        return "death80"
                })
                .attr("class", function (d) { return "date" + d.properties.deathday + " death" })
                .attr("deathday", function (d) { return "date" + d.properties.deathday })
                .attr("transform", function (d) { return "translate(" + projection(d.geometry.coordinates) + ")"; })
                .style("fill", function (d) { return d.properties.color })
                .style("opacity", 0.8)
                .style("stroke", "black")

            maleDeathLayer.selectAll("path")
                .data(maleDeaths)
                .enter()
                .append("path")
                .attr("d", cross)
                .attr("id", function (d) {
                    if (d.properties.age != ">80")
                        return "death" + d.properties.age
                    else
                        return "death80"
                })
                .attr("class", function (d) { return "date" + d.properties.deathday + " death" })
                .attr("deathday", function (d) { return "date" + d.properties.deathday })
                .attr("transform", function (d) { return "translate(" + projection(d.geometry.coordinates) + ")"; })
                .style("fill", function (d) { return d.properties.color })
                .style("opacity", 0.8)
                .style("stroke", "black")

            //create legends

            var color = {
                0: ["0-10", geojson.features[0].properties.color],
                1: ["11-20", geojson.features[1].properties.color],
                2: ["21-40", geojson.features[2].properties.color],
                3: ["41-60", geojson.features[3].properties.color],
                4: ["61-80", geojson.features[4].properties.color],
                5: [">80", geojson.features[5].properties.color]
            };

            legendLayer.selectAll('#legend').data([1, 2, 3, 4, 5, 6])
                .enter()
                .append('g')
                .each(function (d, i) {
                    var g = d3.select(this);
                    g.append("circle")
                        .attr("cx", i * 56 + 12)
                        .attr("cy", 20)
                        .attr("r", 5)
                        .style("fill", color[String(i)][1]);

                    g.append("text")
                        .attr("x", i * 56 + 18)
                        .attr("y", 25)
                        .attr("height", 10)
                        .attr("width", 100)
                        .style("fill", "black")
                        .text(color[String(i)][0]);
                })

            legendLayer.selectAll("#legend")
                .data([1])
                .enter()
                .append("g")
                .append("path")
                .attr("d", cross)
                .attr("transform", "translate(350,20)")
                .style("fill", "black")
            legendLayer.selectAll("#legend")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(360,25)")
                .text("male")

            legendLayer.selectAll("#legend")
                .data([1])
                .enter()
                .append("g")
                .append("path")
                .attr("d", diamond)
                .attr("transform", "translate(410,20)")
                .style("fill", "black")
            legendLayer.selectAll("#legend")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(420,25)")
                .text("female")

            legendLayer.selectAll("#legend")
                .data([1])
                .enter()
                .append("g")
                .append("svg:image")
                .attr("id", "pump")
                .attr("xlink:href", "water-pump-legend.svg")
                .attr("width", 20)
                .attr("height", 20)
                .attr("transform", "translate(480,10)")
                .style("fill", "black")
            legendLayer.selectAll("#legend")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(500,25)")
                .text("pump")

        }

        // Create charts
        d3.json("https://raw.githubusercontent.com/Cecilia0622/myFiles/master/deaths.json", deathChart)
        function deathChart(geojson) {
            deathData = geojson.features;

            var h = d3.select("#barChart").attr("height"),
                w = d3.select("#barChart").attr("width")

            d3.select("#barChart")
                .append("g")
                .attr("id", "bar")

            d3.selectAll("#pieChart")
                .append("g")
                .attr("id", "agePie")
                .attr("transform", "translate(100,150)")

            d3.select("#pieChart")
                .append("g")
                .attr("id", "genderPie")
                .attr("transform", "translate(100,450)")

            // sum death number with respect to date
            var deathDateSum = d3.nest()
                .key(function (d) { return d.properties.deathday; })
                .rollup(function (d) { return d.length; })
                .entries(deathData);

            // create a time parser (modifier) to convert date-string
            var parser = d3.timeParse("%d-%b");
            var dateArray = [];
            // convert date-string to workable date and add another variable (time)
            for (i in deathDateSum) {
                deathDateSum[i].time = parser(deathDateSum[i].key)
                dateArray[i] = "path[deathday=" + deathDateSum[i].key + "]";
            };
            // sort using date
            deathDateSum.sort(function (x, y) {
                return d3.descending(x.time, y.time)
            });

            //define y-axis and labels
            var scaleY = d3.scaleBand()
                .domain(deathDateSum.map(function (d) { return d.key }))
                .range([h / 2 - 10, -h / 2 + 10])
                .paddingInner(0.25);
            var axisY = d3.axisLeft(scaleY);

            d3.select("#barChart").append("g")
                .attr("id", "yAxis")
                .call(axisY)
                .attr("transform", "translate(60,300)")

            
            var selection = [];
            //add bars
            var barLayer = d3.select("#bar")
            barLayer.selectAll("#bar")
                .data(deathDateSum)
                .enter()
                .append('rect')
                .attr("id", function (d) { return d.key })
                .attr("width", function (d) { return d.value; })
                .attr("height", 15)
                .attr("x", 1)
                .attr("y", function (d) { return scaleY(d.key); })
                .attr("fill", "darkred")
                .attr("transform", "translate(60,300)")
                .on("click", function () {
                    var newColor = d3.select(this).attr("fill") == "darkred" ? "orange" : "darkred"
                    d3.selectAll("rect").attr("fill", "darkred")
                    d3.select(this).attr("fill", newColor)
                    var selection = d3.select(this).attr("id")
                    if (selection == "19-Aug") {
                        if (d3.selectAll("[deathday=date19-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date19-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "20-Aug") {
                        if (d3.selectAll("[deathday=date20-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date20-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "21-Aug") {
                        if (d3.selectAll("[deathday=date21-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date21-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "23-Aug") {
                        if (d3.selectAll("[deathday=date23-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date23-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "24-Aug") {
                        if (d3.selectAll("[deathday=date24-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date24-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "26-Aug") {
                        if (d3.selectAll("[deathday=date26-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date26-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "27-Aug") {
                        if (d3.selectAll("[deathday=date27-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date27-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "29-Aug") {
                        if (d3.selectAll("[deathday=date29-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date29-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "30-Aug") {
                        if (d3.selectAll("[deathday=date30-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date30-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "31-Aug") {
                        if (d3.selectAll("[deathday=date31-Aug]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date31-Aug]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "1-Sep") {

                        if (d3.selectAll("[deathday=date1-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date1-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "2-Sep") {

                        if (d3.selectAll("[deathday=date2-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date2-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "3-Sep") {

                        if (d3.selectAll("[deathday=date3-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date3-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "4-Sep") {
                        if (d3.selectAll("[deathday=date4-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date4-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "5-Sep") {
                        if (d3.selectAll("[deathday=date5-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date5-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "6-Sep") {
                        if (d3.selectAll("[deathday=date6-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date6-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "7-Sep") {
                        if (d3.selectAll("[deathday=date7-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date7-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "8-Sep") {
                        if (d3.selectAll("[deathday=date8-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date8-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "9-Sep") {
                        if (d3.selectAll("[deathday=date9-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date9-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "10-Sep") {
                        if (d3.selectAll("[deathday=date10-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date10-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "11-Sep") {
                        if (d3.selectAll("[deathday=date11-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date11-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "12-Sep") {
                        if (d3.selectAll("[deathday=date12-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date12-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "13-Sep") {
                        if (d3.selectAll("[deathday=date13-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date13-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "14-Sep") {
                        if (d3.selectAll("[deathday=date14-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date14-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "15-Sep") {
                        if (d3.selectAll("[deathday=date15-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date15-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "16-Sep") {
                        if (d3.selectAll("[deathday=date16-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date16-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "17-Sep") {
                        if (d3.selectAll("[deathday=date17-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date17-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "18-Sep") {
                        if (d3.selectAll("[deathday=date18-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date18-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "19-Sep") {
                        if (d3.selectAll("[deathday=date19-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date19-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "20-Sep") {
                        if (d3.selectAll("[deathday=date20-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date20-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "21-Sep") {
                        if (d3.selectAll("[deathday=date21-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date21-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "22-Sep") {
                        if (d3.selectAll("[deathday=date22-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date22-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "23-Sep") {
                        if (d3.selectAll("[deathday=date23-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date23-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "24-Sep") {
                        if (d3.selectAll("[deathday=date24-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date24-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "25-Sep") {
                        if (d3.selectAll("[deathday=date25-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date25-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "26-Sep") {
                        if (d3.selectAll("[deathday=date26-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date26-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                    else if (selection == "27-Sep") {
                        if (d3.selectAll("[deathday=date27-Sep]").style("opacity") == 0.8) {
                            d3.selectAll(".death").style("opacity", 0)
                            d3.selectAll("[deathday=date27-Sep]").style("opacity", 1)
                        }
                        else {
                            d3.selectAll(".death").style("opacity", 0.8)
                            d3.select(this).attr("fill", "darkred")
                        }
                    }
                
                })

            //add numbers
            var barText = d3.select("#barChart").append("g")
                .attr("id", "barText")
                .attr("transform", "translate(5,310)")
            barText.selectAll('#barChart').data(deathDateSum).enter().append('text')
                .text(function (d) { return d.value })
                .attr("x", function (d) { return d.value; })
                .attr("y", function (d) { return scaleY(d.key); })
                .attr("font-size", "10px")
                .attr("transform", "translate(60,0)")

            //add barchart title
            var barTitle = d3.select("#barChart")
            barTitle.selectAll("#barChart")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(13,350), rotate(-90)")
                .text("Number of Deaths by Date")
                .attr("font-family", "impact")
                .attr("font-size", "15px")

            // sum death number with respect to age
            var deathAgeSum = d3.nest()
                .key(function (d) { return d.properties.age; })
                .rollup(function (d) { return d.length; })
                .entries(deathData);

            //create pie chart functions
            var pie = d3.pie()
                .sort(null)
                .value(function (d) {
                    return d.value;
                });

            //create arc d3 object to draw arcs
            var arc = d3.arc().innerRadius(0).outerRadius(100)
            textArc = d3.arc().innerRadius(50).outerRadius(100)

            //create color for each pie
            for (i in deathAgeSum) {
                if (deathAgeSum[i].key == deathData[i].properties.age) {
                    deathAgeSum[i].color = deathData[i].properties.color;
                }
                else { }
            };

            var agePieLayer = d3.select("#agePie")
            agePieLayer.selectAll("#agePie")
                .data(pie(deathAgeSum))
                .enter().append("g")

            agePieLayer.selectAll("g")
                .append("text")
                .attr("transform", function (d) { return "translate(" + textArc.centroid(d) + ")"; })
                .attr("text-anchor", "middle")
                .text(function (d) { return d.data.key; })
                .attr("font-size", "10px")

            agePieLayer.selectAll("g")
                .append("path")
                .attr("d", arc)
                .attr("stroke", "black")
                .style("fill", function (d) { return d.data.color; })
                .style("stroke-width", "2px")
                .style("opacity", 0.7)

                .on("mouseover", function (d) {
                    d3.selectAll('rect').attr("fill","darkred")
                    d3.selectAll(".death").style("opacity", 0)
                    if (d3.select(this).style("fill") == "rgb(254, 240, 217)") {
                        d3.selectAll("#death0-10").style("opacity", 1)
                    }
                    else if (d3.select(this).style("fill") == "rgb(253, 212, 158)") {
                        d3.selectAll("#death11-20").style("opacity", 1)
                    }
                    else if (d3.select(this).style("fill") == "rgb(253, 187, 132)") {
                        d3.selectAll("#death21-40").style("opacity", 1)
                    }
                    else if (d3.select(this).style("fill") == "rgb(252, 141, 89)") {
                        d3.selectAll("#death41-60").style("opacity", 1)
                    }
                    else if (d3.select(this).style("fill") == "rgb(227, 74, 51)") {
                        d3.selectAll("#death61-80").style("opacity", 1)
                    }
                    else if (d3.select(this).style("fill") == "rgb(179, 0, 0)") {
                        d3.selectAll("#death80").style("opacity", 1)
                    }
                    return toolTip.text(d.data.key)
                        .style("opacity", .9)
                })

                .on("mousemove", function () {
                    return toolTip.style("top", (event.pageY - 40) + "px")
                        .style("left", (event.pageX - 10) + "px");
                })

                .on("mouseout", function (d) {
                    d3.selectAll(".death").style("opacity", 0.8)
                    return toolTip.style("opacity", 0)
                })


            // sum death number with respect to sex
            var deathGenderSum = d3.nest()
                .key(function (d) { return d.properties.sex; })
                .rollup(function (d) { return d.length; })
                .entries(deathData);

            for (i in deathGenderSum) {
                if (deathGenderSum[i].key == "female") {
                    deathGenderSum[i].color = "lightcoral";
                }
                else {
                    deathGenderSum[i].color = "lightblue";
                }
            };
            // creates pie chart based on gender
            var genderPieLayer = d3.select("#genderPie")
            genderPieLayer.selectAll("#genderPie")
                .data(pie(deathGenderSum))
                .enter().append("g")

            genderPieLayer.selectAll("g")
                .append("text")
                .attr("transform", function (d) { return "translate(" + arc.centroid(d) + ")"; })
                .attr("text-anchor", "middle")
                .text(function (d) { return d.data.key; })
                .attr("font-size", "20px")

            genderPieLayer.selectAll("g")
                .append("path")
                .attr("d", arc)
                .attr("id", function (d) { return d.data.key })
                .attr("stroke", "black")
                .style("fill", function (d) { return d.data.color; })
                .style("stroke-width", "2px")
                .style("opacity", 0.7)
                .on("mouseover", function (d) {
                    d3.selectAll('rect').attr('fill', 'darkred')
                    d3.selectAll('.death').style("opacity", 1)
                    if (d3.select(this).attr("id") != "female") {
                        d3.select("#femaleDeathLayer").style("opacity", 0)
                        
                    }
                    else
                        {
                        d3.select("#maleDeathLayer").style("opacity", 0)
                        
                        }
				    })
                .on("mouseout", function (d) {
				    if (d3.select(this).attr("id") != "female")
					    {d3.select("#femaleDeathLayer").style("opacity",1)}
				    else
					    (d3.select("#maleDeathLayer").style("opacity",1))
				})

            // creates pie chart based on gender

            var pieTitle = d3.select("#pieChart")
            pieTitle.selectAll("#pieChart")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(10,20)")
                .text("Number of Deaths by Age Group")
                .attr("font-family", "impact")

            pieTitle.selectAll("#pieChart")
                .data([1])
                .enter()
                .append("text")
                .attr("transform", "translate(10,320)")
                .text("Number of Deaths by Sex")
                .attr("font-family", "impact")
        }


    </script>
</body>
</html>
